(function(){"use strict";var t={8560:function(t,e,i){var n=i(6369),o=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("ImgEditIndex")],1)},s=[],a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"edit-container-home"},[e("div",{staticClass:"left"},[e("imgEditLeft",{on:{addText:t.addText,addImg:t.addImg,setBgColor:t.colorChange,addIconImg:t.addIconImg}})],1),e("div",{staticClass:"center"},[e("div",{staticClass:"canvas"},[t.isShow?e("canvasIndex",{ref:"canvasIndex",on:{itemClickHandler:t.itemClickHandler}}):t._e()],1)]),e("div",{staticClass:"right"},[e("Button",{on:{click:t.save}},[t._v("保存")]),e("Button",{on:{click:t.editWidth}},[t._v("测试修改画布")]),e("imgEditRight",{ref:"canvasRight",on:{itemChange:t.itemChange,setIconColor:t.setIconColor}})],1),e("div",{staticClass:"demos"})])},l=[],d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"edit-box",style:{width:t.width+"px",height:t.height+"px"}},[e("div",{ref:"imgEditBox",staticClass:"img-edit-box",style:{width:t.width+"px",height:t.height+"px","background-color":t.bgColor},attrs:{id:"img-edit-box-container"},on:{click:function(e){t.activeId=""}}},t._l(t.list,(function(i){return e("div",{key:i.id,staticClass:"list-item",class:{"active-bd":t.activeId==i.id},style:{top:i.top+"px",left:i.left+"px","z-index":i.zIndex,backgroundColor:i.backgroundColor,color:i.color,padding:i.padding+"px",width:i.width?i.width+"px":"auto",height:i.height?i.height+"px":"auto",transform:`rotateZ(${3.6*i.rotateZ}deg)`},attrs:{id:i.id}},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.activeId==i.id,expression:"activeId == item.id"}],staticClass:"point top-left",attrs:{id:`${i.id}.top-left`}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.activeId==i.id,expression:"activeId == item.id"}],staticClass:"point top",attrs:{id:`${i.id}.top`}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.activeId==i.id,expression:"activeId == item.id"}],staticClass:"point top-right",attrs:{id:`${i.id}.top-right`}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.activeId==i.id,expression:"activeId == item.id"}],staticClass:"point right",attrs:{id:`${i.id}.right`}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.activeId==i.id,expression:"activeId == item.id"}],staticClass:"point bottom-right",attrs:{id:`${i.id}.bottom-right`}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.activeId==i.id,expression:"activeId == item.id"}],staticClass:"point bottom",attrs:{id:`${i.id}.bottom`}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.activeId==i.id,expression:"activeId == item.id"}],staticClass:"point bottom-left",attrs:{id:`${i.id}.bottom-left`}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.activeId==i.id,expression:"activeId == item.id"}],staticClass:"point left",attrs:{id:`${i.id}.left`}}),"text"===i.type?e("div",{staticClass:"edit-text",style:{"font-size":i.fontSize+"px",width:i.width+"px",height:i.height+"px"},attrs:{contenteditable:i.contenteditable,id:`${i.id}edit-text`},on:{click:function(e){return e.stopPropagation(),t.listItemClickHandler(i.id)},blur:function(e){return t.listDivBlur(i.id)},dblclick:function(e){return e.stopPropagation(),(()=>{t.divDbClickHandler(i.id)}).apply(null,arguments)},input:function(e){return t.contenteditableChange(`${i.id}edit-text`)}}},[t._v(" "+t._s(i.content)+" ")]):t._e(),"img"==i.type?e("img",{staticClass:"edit-img",style:{width:"100%",height:"100%"},attrs:{src:i.src,crossOrigin:"anonymous"},on:{click:function(e){return e.stopPropagation(),t.listItemClickHandler(i.id)}}}):t._e()])})),0)])},c=[];i(7658);const r={left:0,top:0,backgroundColor:"rgba(0, 0, 0, 0)",color:"rgba(0,0,0,1)",type:"text",content:"双击编辑",padding:0,fontSize:60,width:250,height:94,rotateZ:0},h={left:0,top:0,type:"img",rotateZ:0};var u={text:r,img:h},p=i(2269),m=i.n(p),g={data(){return{list:[],activeId:"editCanvas1693184972766",width:"500",height:"500",bgColor:"rgba(255,255,255,0)"}},mounted(){},beforeDestroy(){this.$refs.imgEditBox&&(this.$refs.imgEditBox.innerHTML="")},methods:{contenteditableChange(t){let e=document.getElementById(t);e.scrollTo({top:0,behavior:"auto"})},setIconColor(t){const{base64:e,id:i}=t,n=this.list.findIndex((t=>t.id==i));this.list[n].src=e,this.$set(this.list,n,this.list[n])},setItemVal(t){const e=this.list.findIndex((e=>e.id==t.id));this.list[e][t.valType]=t.val,this.$set(this.list,e,this.list[e])},setBgColor(t){this.bgColor=t},deletes(t){const e=this.list.findIndex((e=>e.id==t));this.list.splice(e,1)},setDom(){this.width="700",this.height="300",this.list.forEach(((t,e)=>{t.top=300*t.top/500,t.left=700*t.left/500}))},save(){this.activeId="",this.$nextTick((()=>{m()(document.querySelector("#img-edit-box-container"),{backgroundColor:null,useCORS:!0,allowTaint:!0}).then((t=>{console.log(t.toDataURL("image/png"));const e=t.toDataURL("image/png");var i=document.createElement("a");i.setAttribute("href",e),i.setAttribute("download",name),i.setAttribute("target","_blank");let n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),i.dispatchEvent(n)}))}))},listDivBlur(t){const e=this.list.findIndex((e=>e.id==t));this.list[e].contenteditable=!1},listItemClickHandler(t){const e=this.list.findIndex((e=>e.id==t));this.activeId=t,this.$emit("itemClickHandler",this.list[e])},divDbClickHandler(t){const e=this.list.findIndex((e=>e.id==t));this.list[e].contenteditable=!0},addImg(t,e=!1){const i=new Image;i.src=t;const n=this;i.onload=function(){const o=`editCanvas${(new Date).getTime()}`;n.list.push({id:o,zIndex:1,src:t,...u["img"],width:i.width,height:i.height,isIcon:e}),n.$nextTick((()=>{const t=document.getElementById(o),e=document.getElementById("img-edit-box-container");let i=0,s=0;i=e.offsetWidth>=t.offsetWidth?(e.offsetWidth-t.offsetWidth)/2:-(t.offsetWidth-e.offsetWidth)/2,s=e.offsetHeight>=t.offsetHeight?(e.offsetHeight-t.offsetHeight)/2:-(t.offsetHeight-e.offsetHeight)/2;const a=n.list.findIndex((t=>t.id==o));n.list[a].top=s,n.list[a].left=i,n.$set(n.list,a,n.list[a]),n.bindDom(o),n.bindSetDiv(o)}))}},addText(t){const e=`editCanvas${(new Date).getTime()}`;this.list.push({id:e,zIndex:1,contenteditable:!1,...u[t]}),this.$nextTick((()=>{const t=document.getElementById(e),i=document.getElementById("img-edit-box-container"),n=(i.offsetWidth-t.offsetWidth)/2,o=(i.offsetHeight-t.offsetHeight)/2,s=this.list.findIndex((t=>t.id==e));this.list[s].top=o,this.list[s].left=n,this.$set(this.list,s,this.list[s]),this.bindDom(e),this.bindSetDiv(e)}))},bindDom(t){const e=this;let i=document.getElementById(t),n=document.getElementById("img-edit-box-container");i.onmousedown=function(t){t=t||window.event;let o=t.clientX-i.offsetLeft,s=t.clientY-i.offsetTop;document.onmousemove=function(t){t=t||window.event;let a=t.clientX-o,l=t.clientY-s;a<0?a=0:a>n.clientWidth-i.offsetWidth&&(a=n.clientWidth-i.offsetWidth),l<0?l=0:l>n.clientHeight-i.offsetHeight&&(l=n.clientHeight-i.offsetHeight),i.style.left=a+"px",i.style.top=l+"px";const d=e.list.findIndex((t=>t.id==i.id));e.list[d].top=l,e.list[d].left=a},document.onmouseup=function(t){this.onmousemove=null,this.onmouseup=null}}},bindSetDiv(t){var e=document.getElementById(`${t}`);const i=document.getElementById(`${t}.top-left`),n=document.getElementById(`${t}.top`),o=document.getElementById(`${t}.top-right`),s=document.getElementById(`${t}.right`),a=document.getElementById(`${t}.bottom-right`),l=document.getElementById(`${t}.bottom`),d=document.getElementById(`${t}.bottom-left`),c=document.getElementById(`${t}.left`);function r(t){var i=t.target,n=t.pageX,o=t.pageY,s=parseInt(getComputedStyle(e).width),a=parseInt(getComputedStyle(e).height),l=parseInt(getComputedStyle(e).top),d=parseInt(getComputedStyle(e).left);function c(t){const c=i.id.split(".")[1],r=i.id.split(".")[0];var h=t.pageX-n,u=t.pageY-o;const p=document.getElementById(`${r}edit-text`);switch(c){case"top-left":e.style.width=s-h+"px",e.style.height=a-u+"px",e.style.top=l+u+"px",e.style.left=d+h+"px",p&&(p.style.width=s-h+"px",p.style.height=a-u+"px");break;case"top":e.style.height=a-u+"px",e.style.top=l+u+"px",p&&(p.style.height=a-u+"px");break;case"top-right":e.style.width=s+h+"px",e.style.height=a-u+"px",e.style.top=l+u+"px",p&&(p.style.width=s+h+"px",p.style.height=a-u+"px");break;case"right":e.style.width=s+h+"px",p&&(p.style.width=s+h+"px");break;case"bottom-right":e.style.width=s+h+"px",e.style.height=a+u+"px",p&&(p.style.width=s+h+"px",p.style.height=a+u+"px");break;case"bottom":e.style.height=a+u+"px",p.style.height=a+u+"px";break;case"bottom-left":e.style.width=s-h+"px",e.style.height=a+u+"px",e.style.left=d+h+"px",p&&(p.style.width=s-h+"px",p.style.height=a+u+"px");break;case"left":e.style.width=s-h+"px",e.style.left=d+h+"px",p&&(p.style.width=s-h+"px");break;default:break}t.stopPropagation(),t.preventDefault()}function r(t){document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",r)}document.addEventListener("mousemove",c),document.addEventListener("mouseup",r),t.stopPropagation(),t.preventDefault()}i.addEventListener("mousedown",r),n.addEventListener("mousedown",r),o.addEventListener("mousedown",r),s.addEventListener("mousedown",r),a.addEventListener("mousedown",r),l.addEventListener("mousedown",r),d.addEventListener("mousedown",r),c.addEventListener("mousedown",r)}}},f=g,v=i(1001),x=(0,v.Z)(f,d,c,!1,null,"4298a82b",null),I=x.exports,b=function(){var t=this,e=t._self._c;return e("div",{staticClass:"edit-img-left-box"},[e("div",{staticClass:"left-icon-box"},t._l(t.leftIconList,(function(i){return e("div",{key:i.icon,staticClass:"left-icon",class:t.activeType==i.icon?"active-color":"",on:{click:function(e){return t.iconTap(i.icon)}}},[e("Icon",{class:t.activeType==i.icon?"active-icon-color":"",staticStyle:{"font-size":"30px"},attrs:{type:i.icon}}),e("div",{staticClass:"icon-text",class:t.activeType==i.icon?"active-icon-color":""},[t._v(" "+t._s(i.text)+" ")])],1)})),0),e("div",{staticClass:"left-right-edit"},[e("div",{directives:[{name:"show",rawName:"v-show",value:"md-text"==t.activeType,expression:"activeType == 'md-text'"}],staticClass:"text-box"},[e("Button",{staticClass:"add-text-btn",on:{click:t.addText}},[t._v("点击添加文字")])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:"md-albums"==t.activeType,expression:"activeType == 'md-albums'"}]},[e("div",{staticStyle:{padding:"20px"}},[t._v("背景颜色：")]),e("ColorPicker",{staticStyle:{"margin-left":"20px"},attrs:{alpha:""},on:{"on-change":t.colorChange},model:{value:t.color1,callback:function(e){t.color1=e},expression:"color1"}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:"ios-image-outline"==t.activeType,expression:"activeType == 'ios-image-outline'"}]},[e("img",{staticStyle:{width:"100%"},attrs:{src:t.demoSrc,alt:"",srcset:""},on:{click:function(e){return t.addImg(t.demoSrc)}}}),e("div",{staticClass:"upload-btn-box"},[e("Button",{staticClass:"upload-icon"},[t._v("上传图标")]),e("input",{ref:"files",staticClass:"upload-btn",attrs:{type:"file",accept:"image/jpg, image/png"},on:{input:t.fileInput}})],1)])])])},y=[],w={data(){return{demoSrc:"https://gimg3.baidu.com/search/src=http%3A%2F%2Fpics1.baidu.com%2Ffeed%2F83025aafa40f4bfb34053bdc0866f0fcf6361812.jpeg%40f_auto%3Ftoken%3Dee2d57666cd27c587703661edb6ffc85&refer=http%3A%2F%2Fwww.baidu.com&app=2021&size=f360,240&n=0&g=0n&q=75&fmt=auto?sec=1691514000&t=38ac49f490517a164749a5ed7eecfbc3",leftIconList:[{icon:"md-chatboxes",type:"",text:"描述"},{icon:"md-text",type:"",text:"文字"},{icon:"md-albums",type:"",text:"背景"},{icon:"ios-image-outline",type:"",text:"素材"}],activeType:"ios-image-outline",color1:"white"}},methods:{iconTap(t){this.activeType=t},addText(){this.$emit("addText")},addImg(t){this.$emit("addImg",t)},fileInput(){const t=this.$refs.files.files[0],e=this,i=t=>{var i=new FileReader;i.readAsDataURL(t),i.onload=()=>{e.$emit("addIconImg",i.result)},i.onerror=function(t){console.log("Error: ",t)}};i(t)},colorChange(t){this.$emit("setBgColor",t)}}},C=w,$=(0,v.Z)(C,b,y,!1,null,"00eb8fc7",null),k=$.exports,E=function(){var t=this,e=t._self._c;return e("div",{staticClass:"edit-img-right"},t._l(t.list,(function(i,n){return e("div",{key:`editRightList${n}`,staticClass:"list"},[e("div",{staticClass:"title"},[t._v(t._s(i.title))]),"input"==i.type?e("Input",{on:{"on-change":e=>{t.valChange(e,i)}},model:{value:i.val,callback:function(e){t.$set(i,"val",e)},expression:"item.val"}}):t._e(),"numberInput"==i.type?e("InputNumber",{on:{"on-change":e=>{t.valChange(e,i)}},model:{value:i.val,callback:function(e){t.$set(i,"val",e)},expression:"item.val"}}):t._e(),"colorPicker"==i.type?e("ColorPicker",{attrs:{alpha:""},on:{"on-change":e=>{t.valChange(e,i)}},model:{value:i.val,callback:function(e){t.$set(i,"val",e)},expression:"item.val"}}):t._e(),"slider"==i.type?e("Slider",{staticStyle:{margin:"0 20px 0 0px"},attrs:{alpha:"","show-input":""},on:{"on-change":e=>{t.valChange(e,i)}},model:{value:i.val,callback:function(e){t.$set(i,"val",e)},expression:"item.val"}}):t._e(),"setIconColor"==i.type?e("ColorPicker",{on:{"on-change":e=>{t.setIconColor(e,i)}},model:{value:i.val,callback:function(e){t.$set(i,"val",e)},expression:"item.val"}}):t._e()],1)})),0)},T=[];const _={left:"左边距",backgroundColor:"背景颜色",color:"字体颜色",padding:"内容间距",width:"宽",height:"高",content:"内容",top:"上边距",zIndex:"层级",fontSize:"字数大小",rotateZ:"旋转角度"},S={left:"numberInput",top:"numberInput",backgroundColor:"colorPicker",color:"colorPicker",zIndex:"numberInput",fontSize:"numberInput",width:"numberInput",height:"numberInput",rotateZ:"slider"},B={left:"numberInput",top:"numberInput",width:"numberInput",height:"numberInput",rotateZ:"slider"};var D={DESC:_,text:S,img:B},L={data(){return{list:[],id:""}},methods:{initData(t){this.list=[],this.id=t.id,this.val=t,console.log(t,84),Object.keys(D[t.type]).forEach((e=>{this.list.push({type:D[t.type][e],val:t[e],title:D.DESC[e],valType:e})})),t.isIcon&&this.list.push({type:"setIconColor",val:"",title:"修改矢量图颜色",valType:"setIconColor"})},valChange(t,e){this.$emit("itemChange",{id:this.id,...e})},setIconColor(t,e){console.log(t);const i=t=>{let e=t.slice(1),i=[parseInt("0x"+e.slice(0,2)),parseInt("0x"+e.slice(2,4)),parseInt("0x"+e.slice(4,6))];return console.log(i),i};this.changeImageColor(this.val.src,i(t),(t=>{this.$emit("setIconColor",{base64:t,id:this.val.id})}))},changeImageColor(t,e,i){let n=new Image;n.src=t,n.onload=function(){let t=document.createElement("canvas"),o=t.getContext("2d");t.width=n.width,t.height=n.height,o.drawImage(n,0,0,n.width,n.height);let s=o.getImageData(0,0,t.width,t.height);for(let i=0;i<s.data.length;i+=4)0!==s.data[i+3]&&(s.data[i]=e[0],s.data[i+1]=e[1],s.data[i+2]=e[2]);o.putImageData(s,0,0);const a=t.toDataURL("image/png");o.clearRect(0,0,n.width,n.height),i&&i(a)}}}},H=L,R=(0,v.Z)(H,E,T,!1,null,"04047e52",null),O=R.exports,N={components:{canvasIndex:I,imgEditLeft:k,imgEditRight:O},data(){return{color1:"rgba(255,255,255,0)",isShow:!0}},created(){this.errVal=!1},methods:{test(){var t=document.getElementById("editable"),e=document.createRange(),i=window.getSelection();console.log(t.childNodes.length),e.setStart(t.childNodes[1],0),e.collapse(!0),i.removeAllRanges(),i.addRange(e)},async demoDivChange(){const t=[1,2,3,4,5,6,7,8,9,0,";","1","2","3","4","5","6","7","8","9","0"],e=this.$refs.textArea.innerHTML.replace(/<[^>]+>/g,"");if(!e)return;const i=e.split(";");let n="",o="";if(-1!=e.indexOf(";;")){const t=(t,e)=>t.slice(0,e)+t.slice(e+1);return this.$refs.textArea.innerHTML=`<span>${t(e,e.indexOf(";;"))}<span>`,void this.$nextTick((()=>{var t=this.$refs.textArea,e=document.createRange(),i=window.getSelection();e.setStart(t.childNodes[0],1),e.collapse(!0),i.removeAllRanges(),i.addRange(e)}))}if(i.forEach(((e,s)=>{const a=e.split("");let l=!1;a.forEach((e=>{-1==t.indexOf(e)&&""==o&&(o=`${0==s?0:s+(s-1)}`),-1==t.indexOf(e)&&(l=!0)}));let d="";d=l?e.replace(/[^\0-9\;]/g,""):e,n+=`<span>${d}</span>`+(s+1==i.length?"":";")})),""!=o){if(this.timer)return;this.timer=setTimeout((()=>{this.$refs.textArea.innerHTML=n,this.timer=null,o&&this.$nextTick((()=>{var t=this.$refs.textArea,e=document.createRange(),i=window.getSelection();const n=t.childNodes[0==o?o:Number(o)+1].outerText;e.setStart(t.childNodes[0==o?o:Number(o)+1],n.length?1:0),e.collapse(!0),i.removeAllRanges(),i.addRange(e)}))}),200)}},save(){this.$refs.canvasIndex.save()},addText(){this.$refs.canvasIndex.addText("text")},addImg(t){this.$refs.canvasIndex.addImg(t)},addIconImg(t){this.$refs.canvasIndex.addImg(t,!0)},editWidth(){this.$refs.canvasIndex.setDom()},colorChange(t){this.$refs.canvasIndex.setBgColor(t)},itemClickHandler(t){this.$refs.canvasRight.initData(t)},itemChange(t){this.$refs.canvasIndex.setItemVal(t)},setIconColor(t){console.log(t),this.$refs.canvasIndex.setIconColor(t)}}},A=N,P=(0,v.Z)(A,a,l,!1,null,"016049c6",null),W=P.exports,z={name:"App",components:{ImgEditIndex:W}},Z=z,j=(0,v.Z)(Z,o,s,!1,null,null,null),F=j.exports,M=i(2321),U=i.n(M);n["default"].config.productionTip=!1,n["default"].use(U()),new n["default"]({render:t=>t(F)}).$mount("#app")}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,i),s.exports}i.m=t,function(){var t=[];i.O=function(e,n,o,s){if(!n){var a=1/0;for(r=0;r<t.length;r++){n=t[r][0],o=t[r][1],s=t[r][2];for(var l=!0,d=0;d<n.length;d++)(!1&s||a>=s)&&Object.keys(i.O).every((function(t){return i.O[t](n[d])}))?n.splice(d--,1):(l=!1,s<a&&(a=s));if(l){t.splice(r--,1);var c=o();void 0!==c&&(e=c)}}return e}s=s||0;for(var r=t.length;r>0&&t[r-1][2]>s;r--)t[r]=t[r-1];t[r]=[n,o,s]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,n){var o,s,a=n[0],l=n[1],d=n[2],c=0;if(a.some((function(e){return 0!==t[e]}))){for(o in l)i.o(l,o)&&(i.m[o]=l[o]);if(d)var r=d(i)}for(e&&e(n);c<a.length;c++)s=a[c],i.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return i.O(r)},n=self["webpackChunkimg_edit"]=self["webpackChunkimg_edit"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(8560)}));n=i.O(n)})();
//# sourceMappingURL=app.1d3670c1.js.map